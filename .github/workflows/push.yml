on:
  push:
    branches:
      - master

name: deploy

jobs:
  deploy:
    name: deploy to cluster
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Deploy to Railway
        run: |
          $headers = @{
            "Content-Type" = "application/json"
            "Authorization" = "Bearer $env:RAILWAY_API_TOKEN"
          }
          $body = @{
            "projectId" = "cfb9cc1d-7642-45ff-8e1a-1e7edd3f16b1"
            "services" = @("nodejs-mysql-restapi")
          }
          $url = "https://cloud.railway.app/v1/services/deploy"
          Invoke-RestMethod -Uri $url -Headers $headers -Method Post -Body ($body | ConvertTo-Json)

